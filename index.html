<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tesla IPTV Player â€” Grouped</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
body { margin: 0; background: #000; color: white; font-family: sans-serif; display: flex; height: 100vh; }
#sidebar { width: 30%; background: #111; overflow-y: auto; padding: 10px; }
#video-container { flex: 1; display: flex; justify-content: center; align-items: center; background: black; }
video { width: 100%; height: auto; max-height: 100%; }
.group { margin-bottom: 10px; }
.group-name { font-weight: bold; font-size: 16px; margin-top: 8px; }
.channel { padding: 4px 6px; cursor: pointer; border-bottom: 1px solid #333; }
.channel:hover { background: #222; }
input { width: 100%; padding: 5px; margin-bottom: 10px; }
</style>
</head>
<body>
<div id="sidebar">
  <input type="text" id="search" placeholder="Search channels...">
  <div id="channels"></div>
</div>
<div id="video-container">
  <video id="video" controls autoplay></video>
</div>
<script>
async function loadM3U() {
  const res = await fetch('channels.m3u');
  const text = await res.text();
  const lines = text.split('\n');
  const channels = [];
  for (let i = 0; i < lines.length; i++) {
    if (lines[i].startsWith('#EXTINF')) {
      const nameMatch = lines[i].match(/,(.*)$/);
      const name = nameMatch ? nameMatch[1] : 'Unknown';
      const groupMatch = lines[i].match(/group-title="([^"]+)"/i);
      const group = groupMatch ? groupMatch[1] : 'Other';
      const url = lines[i + 1]?.trim();
      if (url && url.startsWith('http')) channels.push({ name, url, group });
    }
  }
  return channels;
}

function playChannel(url) {
  const video = document.getElementById('video');
  if (Hls.isSupported()) {
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
  } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = url;
    video.play();
  } else {
    alert('HLS not supported on this browser');
  }
}

function renderChannels(channels, filter = '') {
  const container = document.getElementById('channels');
  container.innerHTML = '';
  
  // Group channels by group-title
  const groups = {};
  channels.forEach(ch => {
    if (!ch.name.toLowerCase().includes(filter.toLowerCase())) return;
    if (!groups[ch.group]) groups[ch.group] = [];
    groups[ch.group].push(ch);
  });

  Object.keys(groups).sort().forEach(groupName => {
    const groupDiv = document.createElement('div');
    groupDiv.className = 'group';
    const title = document.createElement('div');
    title.className = 'group-name';
    title.textContent = groupName;
    groupDiv.appendChild(title);

    groups[groupName].forEach(ch => {
      const chDiv = document.createElement('div');
      chDiv.className = 'channel';
      chDiv.textContent = ch.name;
      chDiv.onclick = () => playChannel(ch.url);
      groupDiv.appendChild(chDiv);
    });

    container.appendChild(groupDiv);
  });
}

loadM3U().then(channels => {
  renderChannels(channels);
  const search = document.getElementById('search');
  search.addEventListener('input', e => renderChannels(channels, e.target.value));
});
</script>
</body>
</html>
